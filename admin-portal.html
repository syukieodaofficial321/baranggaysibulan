<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - Barangay Sibulan</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #006400; 
            --secondary-color: #FFD700;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9)), url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTuTK34t1qtwwqcbjnlGwLFFOhunOG2eXoe4A&s');
            background-size: cover;
            background-attachment: fixed;
        }
        
        /* Sidebar */
        .sidebar {
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            background-color: var(--primary-color);
            color: white;
            padding-top: 20px;
            transition: all 0.3s;
        }
        
        .sidebar-brand {
            text-align: center;
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 30px;
            padding: 0 15px;
        }
        
        .sidebar-menu a {
            display: block;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            padding: 15px 25px;
            border-left: 4px solid transparent;
            transition: 0.3s;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(255,255,255,0.1);
            color: white;
            border-left-color: var(--secondary-color);
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 30px;
        }

        .card-dashboard {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            background: white;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-brand">
            Barangay Sibulan<br>
            <small style="font-size: 0.7em; font-weight: 400;">Admin Portal</small>
        </div>
        <div class="sidebar-menu">
            <a href="#" class="active" onclick="switchView('dashboard', this)">Dashboard</a>
            <a href="#" onclick="switchView('officials', this)">Manage Officials</a>
            <a href="#" onclick="switchView('settings', this)">Site Settings</a>
            <a href="#" id="logoutBtn" style="margin-top: 50px; border-top: 1px solid rgba(255,255,255,0.1);">Logout</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container-fluid">
            
            <!-- Dashboard View -->
            <div id="dashboard-view">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold text-dark">Certificate Requests</h2>
                    <button class="btn btn-success">Export Data</button>
                </div>

                <!-- Table -->
                <div class="card-dashboard p-4">
                    <h5 class="mb-3">Recent Requests</h5>
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Date</th>
                                    <th>Resident Name</th>
                                    <th>Type</th>
                                    <th>Purpose</th>
                                    <th>Contact</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- Data will be loaded here via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Manage Officials View -->
            <div id="officials-view" style="display: none;">
                <h2 class="fw-bold text-dark mb-4">Manage Officials</h2>
                
                <!-- Add/Edit Form -->
                <div class="card-dashboard p-4 mb-4">
                    <h5>Add / Edit Official</h5>
                    <form id="officialForm">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <input type="text" class="form-control" id="offName" placeholder="Full Name (e.g. Hon. Juan Cruz)" required>
                            </div>
                            <div class="col-md-4">
                                <input type="text" class="form-control" id="offPosition" placeholder="Position (e.g. Kagawad)" required>
                            </div>
                            <div class="col-md-4">
                                <button type="submit" class="btn btn-primary w-100">Save Official</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Officials List -->
                <div class="card-dashboard p-4">
                    <h5>Current Officials List</h5>
                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="officialsTableBody">
                            <!-- JS will load officials here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Site Settings View -->
            <div id="settings-view" style="display: none;">
                <h2 class="fw-bold text-dark mb-4">Site Settings</h2>
                <div class="card-dashboard p-4">
                    <h5>Footer Contact Details</h5>
                    <form id="footerForm">
                        <div class="mb-3">
                            <label class="form-label">Office Name</label>
                            <input type="text" class="form-control" id="setOffice" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address Line 1</label>
                            <input type="text" class="form-control" id="setAddr1" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Address Line 2</label>
                            <input type="text" class="form-control" id="setAddr2" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Telefax</label>
                            <input type="text" class="form-control" id="setTelefax" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Mobile Phone</label>
                            <input type="text" class="form-control" id="setMobile" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="text" class="form-control" id="setEmail" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Settings</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 1. Check if User is Logged In
        if (!sessionStorage.getItem('isLoggedIn')) {
            window.location.href = 'login.html';
        }

        // 2. Logout Function
        document.getElementById('logoutBtn').addEventListener('click', function() {
            sessionStorage.removeItem('isLoggedIn');
            window.location.href = 'login.html';
        });

        // 3. Load Requests from LocalStorage
        function loadData() {
            const requests = JSON.parse(localStorage.getItem('barangayRequests')) || [];
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (requests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">No requests found.</td></tr>';
                return;
            }

            requests.forEach(req => {
                const statusBadge = req.status === 'Pending' ? 'bg-warning text-dark' : 'bg-success';
                
                const row = `
                    <tr>
                        <td>${req.date}</td>
                        <td>${req.name}</td>
                        <td>${req.type}</td>
                        <td>${req.purpose}</td>
                        <td>${req.contact}</td>
                        <td><span class="badge ${statusBadge}">${req.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-success" onclick="updateStatus(${req.id}, 'Approved')">Approve</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteRequest(${req.id})">Delete</button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Initial Load
        loadData();

        // 4. Action Functions
        window.updateStatus = function(id, newStatus) {
            let requests = JSON.parse(localStorage.getItem('barangayRequests')) || [];
            const index = requests.findIndex(r => r.id === id);
            if (index !== -1) {
                requests[index].status = newStatus;
                localStorage.setItem('barangayRequests', JSON.stringify(requests));
                loadData();
            }
        };

        window.deleteRequest = function(id) {
            if(confirm('Are you sure you want to delete this request?')) {
                let requests = JSON.parse(localStorage.getItem('barangayRequests')) || [];
                requests = requests.filter(r => r.id !== id);
                localStorage.setItem('barangayRequests', JSON.stringify(requests));
                loadData();
            }
        };

        // 5. View Switching Logic
        window.switchView = function(viewName, link) {
            // Hide all views
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('officials-view').style.display = 'none';
            document.getElementById('settings-view').style.display = 'none';
            
            // Show selected view
            document.getElementById(viewName + '-view').style.display = 'block';

            // Update Sidebar Active State
            document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
            link.classList.add('active');

            if(viewName === 'officials') {
                loadAdminOfficials();
            } else if(viewName === 'settings') {
                loadSettings();
            }
        };

        // 6. Officials Management Logic
        function loadAdminOfficials() {
            const officials = JSON.parse(localStorage.getItem('barangayOfficials')) || [];
            const tbody = document.getElementById('officialsTableBody');
            tbody.innerHTML = '';

            officials.forEach((off, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${off.name}</td>
                        <td>${off.position}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteOfficial(${index})">Remove</button>
                        </td>
                    </tr>
                `;
            });
        }

        document.getElementById('officialForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('offName').value;
            const position = document.getElementById('offPosition').value;

            const officials = JSON.parse(localStorage.getItem('barangayOfficials')) || [];
            officials.push({ name, position, img: 'https://via.placeholder.com/150' });
            localStorage.setItem('barangayOfficials', JSON.stringify(officials));
            
            this.reset();
            loadAdminOfficials();
        });

        window.deleteOfficial = function(index) {
            const officials = JSON.parse(localStorage.getItem('barangayOfficials')) || [];
            officials.splice(index, 1);
            localStorage.setItem('barangayOfficials', JSON.stringify(officials));
            loadAdminOfficials();
        };

        // 7. Settings Management Logic
        function loadSettings() {
            const defaultFooter = {
                office: "INVESTMENT PROMOTIONS AND TOURISM OFFICE",
                addr1: "(Provincial Agri-Industrial Center)",
                addr2: "Municipal Hall, Sta. Cruz, Davao del Sur",
                telefax: "Telefax No. +63822720741",
                mobile: "Mobile Phone No. +639203136792 / +639208567991",
                email: "E-mail: paic_stacruz@yahoo.com"
            };
            const footer = JSON.parse(localStorage.getItem('barangayFooterDetails')) || defaultFooter;

            document.getElementById('setOffice').value = footer.office;
            document.getElementById('setAddr1').value = footer.addr1;
            document.getElementById('setAddr2').value = footer.addr2;
            document.getElementById('setTelefax').value = footer.telefax;
            document.getElementById('setMobile').value = footer.mobile;
            document.getElementById('setEmail').value = footer.email;
        }

        document.getElementById('footerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const footer = {
                office: document.getElementById('setOffice').value,
                addr1: document.getElementById('setAddr1').value,
                addr2: document.getElementById('setAddr2').value,
                telefax: document.getElementById('setTelefax').value,
                mobile: document.getElementById('setMobile').value,
                email: document.getElementById('setEmail').value
            };
            localStorage.setItem('barangayFooterDetails', JSON.stringify(footer));
            alert('Footer settings saved successfully!');
        });
    </script>
</body>
</html>